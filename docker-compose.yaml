services:
  ocf-server:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: iot-gateway-rpi
    hostname: rpi-gateway
    network_mode: "host"  # ← THÊM DÒNG NÀY, XÓA phần networks bên dưới
    volumes:
      - sensor-state:/tmp
    restart: unless-stopped
    tty: true
    stdin_open: true
    environment:
      - PYTHONUNBUFFERED=1

  # Giữ nguyên client containers
  ocf-client-1:
    build:
      context: .
      dockerfile: Dockerfile.client
    container_name: iot-client-laptop
    hostname: client-laptop
    networks:
      iot-network:
        ipv4_address: 172.20.0.20
    environment:
      - SERVER_IP=192.168.1.3  # ← ĐỔI THÀNH IP PC
    depends_on:
      - ocf-server
    restart: unless-stopped
    tty: true
    stdin_open: true

  ocf-client-2:
    build:
      context: .
      dockerfile: Dockerfile.client
    container_name: iot-client-mobile
    hostname: client-mobile
    networks:
      iot-network:
        ipv4_address: 172.20.0.21
    environment:
      - SERVER_IP=192.168.1.3  # ← ĐỔI THÀNH IP PC
    depends_on:
      - ocf-server
    restart: unless-stopped
    tty: true
    stdin_open: true

networks:
  iot-network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.20.0.0/24
          gateway: 172.20.0.1

volumes:
  sensor-state: